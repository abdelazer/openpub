#summary The current bleeding-edge draft of the OPDS Catalog specification.
#labels Featured,Phase-Design

<wiki:toc max_depth="4" />

= Status of this Draft =

This document specifies a draft of the OPDS Catalog specification. Distribution of this memo is unlimited.

= License =

This document is licensed under [http://creativecommons.org/licenses/by-sa/3.0/ Creative Commons Attribution-Share Alike].

= Abstract =

The Open Publication Distribution System (OPDS) Catalog format is a syndication format for electronic publications based on Atom and HTTP. Catalogs enable the aggregation, distribution, discovery, and acquisition of electronic publications. OPDS Catalogs use existing or emergent open standards and conventions, with a priority on simplicity. 

= Introduction =

The Open Publication Distribution System (OPDS) Catalog format is a syndication format for electronic publications based on Atom `[RFC4287]` and HTTP `[RFC2616]`. OPDS Catalogs enable available electronic publications to be:

  * discovered, using optional search or a range of optional browsing techniques TODO
  * acquired, using direct downloads, lending, or vending

An OPDS Catalog is made up of one or more Atom Feeds. As with Atom, each Feed is a list of Entries. Each Entry either points to another Feed and is part of the Catalog's hierarchy or else it describes an available electronic publication, including basic metadata, the publication's format, and how the publication can be acquired. An Entry may have a more extensive, standalone representation outside of the version included in the Feed at a unique URI.

OPDS Catalogs may be aggregated and combined into larger OPDS Catalogs.

= Notational Conventions =

The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in `[RFC2119]`.

= XML-Related Conventions =

== Referring to Information Items ==

The OPDS Catalog format is specified in terms of the XML Information Set `[REC-xml-infoset]`, serialized as XML 1.0 `[REC-xml]`.

The Infoset terms "Element Information Item" and "Attribute Information Item" are shortened to "element" and "attribute" respectively. Therefore, when this specification uses the term "element", it is referring to an Element Information Item, and when it uses the term "attribute", it is referring to an Attribute Information Item.

= RELAX NG Schema =

Some sections of this specification are illustrated with fragments of a non-normative RELAX NG Compact schema `[RNC]`. However, the text of this specification provides the definition of conformance. Complete schemas appear in Appendix B.

= Terminology =

For convenience, instances of this format can be referred to as "OPDS Catalogs" or "OPDS Catalog Documents." The following terminology is used by this specification:

  * Acquisition Link - An atom:link element with a relation that begins "http://opds-spec.org/acquisition" and refers to the Resource which holds the content of the described electrnic publication for any OPDS Catalog Entry. See the Section Acquisition Relations.
  * Catalog - An Atom feed containing a list of publications.
  * Complete Catalog Entry - An OPDS Catalog Entry that includes all known metadata and is linked from a Partial Catalog Entry.
  * Entry - An Atom Entry as defined in `[RFC4287]`. 
  * Feed - An Atom Feed as defined in `[RFC4287]`. 
  * Hierarchical Collection - A Feed whose Entries are not OPDS Catalog Entries but instead link to other Hierarchical or Publication Collections to establish a hierarchical presentation for the Catalog.
  * IRI - An Internationalized Resource Identifier as defined in `[RFC3987]`. Before an IRI found in a document is used by HTTP, the IRI is first converted to a URI. 
  * OPDS Catalog Entry - An Entry provides a representation of an available electronic publication and includes an Acquisition Link. 
  * OPDS Catalog Root - The Feed that represents either the complete OPDS Catalog if it is limited to a Publication Collection or else is the starting Feed in a set of Hierarchical Collections. External links to the Catalog are made to the OPDS Catalog Root Resource.
  * Partial Catalog Entry - An OPDS Catalog Entry that includes the minimal required metadata but no other metadata and links to the Complete Catalog Entry. 
  * Publication - An electronic document, typically as a single file. OPDS is agnostic about the particular format of publications.
  * Publication Collection - A Feed whose Entries are exclusively OPDS Catalog Entries. 
  * relation (or "relation of") - Refers to the "rel" attribute value of an atom:link element.
  * Representation - An entity included with a request or response as defined in `[RFC2616]`.
  * Resource - A network-accessible data object or service identified by an IRI, as defined in `[RFC2616]`. See `[REC-webarch]` for further discussion on Resources.
  * URI - A Uniform Resource Identifier as defined in `[RFC3986]`. In this specification, the phrase "the URI of a document" is shorthand for "a URI which, when dereferenced, is expected to produce that document as a representation".
  
== Acquisition Types ==

Additional terminology describes the acquisition scenario for a particular publication:

  * "Direct acquisition" - The Acquisition Link will return the actual bytes of the publication when traversed, either directly or via HTTP redirection.
  * "Indirect acquisition" - The Acquisition Link will lead to one or more intermediate content-types before the publication is acquired.

The most typical indirect acquisition scenario is a link to an HTML page which prompts a user for 
authentication and/or payment.  When the transaction is satisfactorily completed, the publication bytes 
are eventually returned.

= Document Types =

This specification defines two kinds of documents -- OPDS Catalog Documents and OPDS Catalog Entry Documents.

An OPDS Catalog Document is a refinement of an "atom:feed" from the Atom Syndication Format `[RFC4287]`.

An OPDS Catalog Entry Document is a refinement of an "atom:entry" from the Atom Syndication Format `[RFC4287]`.

The namespace name `[REC-xml-names]` for elements defined in this specification and used in OPDS Catalog Documents and OPDS Catalog Entry Documents is:

http://opds-spec.org/2010/catalog

OPDS Catalog Documents MUST be "namespace-well-formed" as specified in Section 7 of `[REC-xml-names]`.

This specification uses the prefix "opds:" for the namespace name. The prefix "atom:" is used for "http://www.w3.org/2005/Atom ", the namespace name of the Atom Syndication Format `[RFC4287]`. These namespace prefixes are not semantically significant.

== Document Extensibility ==

Unrecognized markup in an OPDS Catalog is considered "foreign markup" as defined in Section 6 of the Atom Syndication Format `[RFC4287]`. Foreign markup can be used anywhere within a Catalog unless it is explicitly forbidden. Processors that encounter foreign markup MUST NOT stop processing and MUST NOT signal an error. Clients SHOULD preserve foreign markup when transmitting or aggregating such documents.

The namespace name "http://opds-spec.org/2010/catalog" is reserved for forward-compatible revisions of the Catalog format. This does not exclude the addition of elements and attributes that might not be recognized by processors conformant to this specification. Such unrecognized markup from the "http://opds-spec.org/2010/catalog" namespace MUST be treated as foreign markup.

TODO: Confirm that the above is our desired forward-compatibility goal.

= OPDS Catalog Documents =

OPDS Catalog Documents are Atom `[RFC4287]` Feed documents have two serve two purposes:

  * To create a hierarchy of other OPDS Catalog Documents. These Catalog Documents are referred to as Hierarchical Collections. 
  * To collect a set of OPDS Catalog Entries. These Catalog Documents are referred to as Publication Collections. 

While Hierarchical Collections do provide a suggested hierarchy from the Catalog publisher, OPDS Catalog Documents MAY contain other relations that allow for other methods of consumption and display.

Every OPDS Catalog Document MUST either be a Hierarchical Collection or a Publication Collection. A Publication Collection can be identified by the presence of Acquisition Links in each Entry.

== OPDS Catalog Root ==

The OPDS Catalog is the top-level OPDS Catalog Document and is either a Publication Collection in the simple case or the top of a set of Hierarchical Collections. Every OPDS Catalog MUST have one and only one OPDS Catalog Root. 

External links to the OPDS Catalog Resource SHOULD use the IRI of the OPDS Catalog Root.

Each OPDS Catalog Document SHOULD contain an atom:link element with a link relation of "start", which references the OPDS Catalog Root Resource.

== Hierarchical Collections ==

A Hierarchical Collection is an OPDS Catalog Document whose Entries serve to create a suggested hierarchy for presentation and browsing. A Hierarchical Collection MUST NOT contain OPDS Catalog Entries but instead contains basic Atom Entries that link to other Hierarchical or Publication Collections or other Resources. Each Entry's atom:content SHOULD include a brief description of the linked Resource.

Links to Hierarchical Collections SHOULD use the type attribute "application/atom+xml;type=feed;profile=opds-catalog". OPDS Catalog providers should choose the best relation for each Hierarchical Collection based on the relations in Catalog Relations. The relation "subsection" MUST be used if no other relation is more appropriate.

== Publication Collections ==

A Publication Collection is an OPDS Catalog Document that collects OPDS Catalog Entries into a single, ordered set. The simplest complete OPDS Catalog would be a single Publication Collection listing all of the available OPDS Catalog Entries from that provider. In more complex Catalogs, Publication Collections are used to present and organize sets of related OPDS Catalog Entries for browsing and discovery by clients and aggregators. 

Links to Publication Collections SHOULD use the type attribute "application/atom+xml;type=feed;profile=opds-catalog".

For further details on limiting the size of Publication Collections through pagination, Partial Catalog Entries, and compression, see the Section Listing Publication Collections.

== Catalog Relations ==

OPDS Catalog Documents SHOULD include links to other available Publication and Hierarchical Collections and other related Resources to encourage independent navigation. This specification defines six new relations for linking from OPDS Catalog Documents at the feed level:

  * "http://opds-spec.org/bookshelf": A Resource that includes a user's existing set of electronic publications, which MAY be represented as an OPDS Catalog.
  * "http://opds-spec.org/crawlable": A complete OPDS Catalog in a single, unpaged atom:feed. See Complete Publication Collections.
  * "http://opds-spec.org/sort/featured": A Publication Collection with featured Entries.
  * "http://opds-spec.org/sort/new": A Publication Collection with newly released Entries.
  * "http://opds-spec.org/sort/popular": A Publication Collection with popular Entries.
  * "http://opds-spec.org/subscriptions": TODO

The following relations are derived from `[DRAFT-Web-Linking]`, with some clarification:

  * "alternate": This Catalog in another format.
  * "first": The initial page in a paginated Publication Collection.
  * "help": A Resource that describes how the Catalog or publications may be used.
  * "last": The final page in a paginated Publication Collection.
  * "license": The license under which this OPDS Catalog is released.
  * "next": The following page in a paginated Publication Collection.
  * "previous": The previous page in a paginated Publication Collection.
  * "related": A Publication Collection that  (best way to suggest related OPDS collection feeds. For example while browsing new release in romance, a related link could suggest the most popular publications in romance)
  * "self": This Catalog.
  * "start": The OPDS Catalog Root.
  * "subsection": A Hierarchical Collection not better described by a more specific relation. 
  * "up": The parent of this Catalog in a Hierarchical Collection.

== Search ==

A catalog MAY provide a search facility through an `[OpenSearch]` Description Document. 
Links to such documents MUST use the "search" relationship and "application/opensearchdescription+xml" type.

{{{
<link rel="search" href="search.xml" type="application/opensearchdescription+xml"/>
}}}

In an `[OpenSearch]` Description Document, the search interface SHOULD use the type associated to OPDS:
{{{
<Url type="application/atom+xml;profile=opds-catalog"
      template="http://example.com/search?q={searchTerms}" />
}}}

OPDS Feeds MAY also display additional elements from the `[OpenSearch]` namespace such as "opensearch:totalResults" or "opensearch:itemsPerPage" in `[OpenSearch]` responses.

== Examples ==

An OPDS Catalog Root that is the top of a set of Hierarchical Collections references two other Catalog Documents using atom:links:
{{{
<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <id>urn:uuid:2853dacf-ed79-42f5-8e8a-a7bb3d1ae6a2</id>
  <link rel="self"  href="/opds-catalogs/root.xml" type="application/atom+xml;type=feed;profile=opds-catalog"/>
  <link rel="start" href="/opds-catalogs/root.xml" type="application/atom+xml;type=feed;profile=opds-catalog"/>
  <title>OPDS Catalog Root Example</title>
  <updated>2010-01-10T10:03:10Z</updated>
  <author>
    <name>Spec Writer</name>
    <uri>http://opds-spec.org</uri>
  </author>

  <entry>
    <title>Popular Publications</title>
    <link type="application/atom+xml;type=feed;profile=opds-catalog" rel="http://opds-spec.org/sort/popular" href="/opds-catalogs/popular.xml"/>
    <updated>2010-01-10T10:01:01Z</updated>
    <id>urn:uuid:d49e8018-a0e0-499e-9423-7c175fa0c56e</id>
    <content type="text">Popular publications from this catalog based on downloads.</content>
  </entry>
  <entry>
    <title>New Publications</title>
    <link type="application/atom+xml;type=feed;profile=opds-catalog" rel="http://opds-spec.org/sort/new" href="/opds-catalogs/new.xml"/>
    <updated>2010-01-10T10:02:00Z</updated>
    <id>urn:uuid:d49e8018-a0e0-499e-9423-7c175fa0c56c</id>
    <content type="text">Recent publications from this catalog.</content>
  </entry>
  <entry>
    <title>Unpopular Publications</title>
    <link type="application/atom+xml;type=feed;profile=opds-catalog" rel="subsection" href="/opds-catalogs/unpopular.xml"/>
    <updated>2010-01-10T10:01:00Z</updated>
    <id>urn:uuid:d49e8018-a0e0-499e-9423-7c175fa0c56d</id>
    <content type="text">Publications that could use some love.</content>
</feed>
}}}

A Publication Collection listing OPDS Catalog Entries from the "Unpopular Publications" Entry in the Hierarchical Collection above:
{{{
<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"
      xmlns:dc="http://purl.org/dc/terms/"
      xmlns:opds="http://opds-spec.org/2010/catalog">
  <id>urn:uuid:433a5d6a-0b8c-4933-af65-4ca4f02763eb</id>

  <link rel="related" href="/opds-catalogs/vampire.farming.xml" type="application/atom+xml;type=feed;profile=opds-catalog"/>
  <link rel="self"    href="/opds-catalogs/unpopular.xml"       type="application/atom+xml;type=feed;profile=opds-catalog"/>
  <link rel="start"   href="/opds-catalogs/root.xml"            type="application/atom+xml;type=feed;profile=opds-catalog"/>
  <link rel="up"      href="/opds-catalogs/root.xml"            type="application/atom+xml;type=feed;profile=opds-catalog"/>

  <title>Unpopular Publications</title>
  <updated>2010-01-10T10:01:11Z</updated>
  <author>
    <name>Spec Writer</name>
    <uri>http://opds-spec.org</uri>
  </author>

  <entry>
    <title>Bob, Son of Bob</title>
    <id>urn:uuid:6409a00b-7bf2-405e-826c-3fdff0fd0734</id>
    <author>
      <name>Bob the Recursive</name>
      <uri>http://opds-spec.org/authors/1285</uri>
    </author>
    <updated>2010-01-10T10:01:11Z</updated>
    <dc:language>en</dc:language>
    <dc:issued>1917</dc:issued>
    <content type="text">The story of the son of the Bob and the gallant part he played in the lives of a man and a woman.</content>
    <link type="image/png" rel="http://opds-spec.org/cover"     href="http://opds-spec.org/covers/4561.lrg.png"/>
    <link type="image/gif" rel="http://opds-spec.org/thumbnail" href="http://opds-spec.org/covers/4561.thmb.gif"/>

    <link type="application/epub+zip"           
          rel="http://opds-spec.org/acquisition" 
          href="http://opds-spec.org/content/free/4561.epub">
      <dc:format>application/epub+zip</dc:format>
    </link>      
    <link type="application/x-mobipocket-ebook" 
          rel="http://opds-spec.org/acquisition" 
          href="http://opds-spec.org/content/free/4561.mobi">
      <dc:format>application/x-mobipocket-ebook</dc:format>
    </link>      
 </entry>

 <entry>
    <title>Modern Online Philately</title>
    <id>urn:uuid:7b595b0c-e15c-4755-bf9a-b7019f5c1dab</id>
    <author>
      <name>Stampy McGee</name>
      <uri>http://opds-spec.org/authors/21285</uri>
    </author>
    <author>
      <name>Alice McGee</name>
      <uri>http://opds-spec.org/authors/21284</uri>
    </author>
    <author>
      <name>Harold McGee</name>
      <uri>http://opds-spec.org/authors/21283</uri>
    </author>
    <updated>2010-01-10T10:01:10Z</updated>
    <dc:identifier>urn:isbn:978029536341X</dc:identifier>
    <dc:publisher>StampMeOnline, Inc.</dc:publisher>
    <dc:language>en</dc:language>
    <dc:issued>2009-10-01</dc:issued>
    <content type="text">The definitive reference for the web-curious philatelist.</content>/opds-catalogs/vampire.farming.xml
    <link type="image/jpeg" rel="http://opds-spec.org/cover" href="http://opds-spec.org/covers/11241.lrg.jpg"/>

    <link type="text/html"           
          rel="http://opds-spec.org/acquisition/buy" 
          href="http://opds-spec.org/content/buy/11241.epub">
      <dc:format>application/epub+zip</dc:format>
      <opds:price currencycode="USD">18.99</opds:price>
    </link>
 </entry>
</feed>
}}}

== Element Definitions ==

=== The "atom:feed" Element ===

The "atom:feed" element is the document (i.e., top-level) element of an OPDS Catalog Document, acting as a container for metadata, hierarchy, and publications associated with the Catalog.  Its element children consist of metadata elements followed by zero or more atom:entry child elements.

The following child elements are refined by this specification:

  * OPDS Catalog Documents SHOULD contain one atom:link element with a rel attribute value of "self". This is the preferred URI for retrieving the atom:feed representing this OPDS Catalog Document.

= OPDS Catalog Entry Documents =

OPDS Catalog Entry Documents are Atom `[RFC4287]` Entry documents that provide a complete representation of the metadata and data associated with an available electronic publication.

Each OPDS Catalog Entry Document MUST include at least one Acquisition Link, which is an atom:link element with a relation that begins "http://opds-spec.org/acquisition". This link refers to the Resource which is the content of the electronic publication described by the OPDS Catalog Entry in a particular media type. Acquisition Links use one of the relations described in Acquisition Relations.

== Partial and Complete Catalog Entries ==

OPDS Catalog Entries may be represented as either a Partial or Complete Catalog Entry. Partial Catalog Entries include only critical metadata elements to reduce the size of OPDS Catalog documents for bandwidth- and resource-limited clients and link to their alternate representation as a Complete Catalog Entries, which include all metadata elements. A Partial Catalog Entry MUST include an "alternate" link relation referencing the Complete Catalog Entry Resource and that atom:link MUST use the type attribute "application/atom+xml;type=entry;profile=opds-catalog". Any Catalog Entry without a link to a Complete Catalog Entry MUST include all metadata elements.

Partial Catalog Entries SHOULD include the following metadata elements, if available:

  * atom:category 
  * atom:rights
  * dc:extent
  * dc:identifier
  * dc:issued 
  * dc:language
  * dc:publisher
  * opds:price 
  * prism:issue
  * prism:volume

OPDS Catalog providers are strongly encouraged to limit metadata elements not required by Atom, OPDS, or listed above from Partial Catalog Entries to help facilitate the efficient transmission and consumption of OPDS Catalog documents. Implementers are encouraged to use Complete Catalog Entries to include experimental, exploratory, and esoteric metadata.

== Entry Relations ==

OPDS Catalog Documents SHOULD include links to related Resources. This specification defines five new relations for linking from OPDS Catalog Entry Documents. They are defined in the Sections Acquisition Relations and Covers and Artwork Relations.

The following relations are derived from `[DRAFT-Web-Linking]`, with some clarification:

  * "alternate": Identifies a Resource that describes this electronic publication in another format (a
  * "copyright": Refers to a copyright statement that applies to this OPDS Catalog Entry.
  * "latest-version": Refers to a more recent version of the electronic publication described by this OPDS Catalog Entry.
  * "license": Refers to a license associated with this OPDS Catalog Entry.
  * "related": Refers to a similar OPDS Catalog Entry.
  * "replies ": Refers to a comment on or discussion of this OPDS Catalog Entry.

=== Acquisition Relations ===

Acquisition Relations describe the extent of the content referred to by an Acquisition Link or the manner in which that Resource may be acquired. This specification defines five Acquisition Relations, which all begin with "http://opds-spec.org/acquisition": 

  * "http://opds-spec.org/acquisition": Indicates that the complete representation of the content Resource may be retrieved without payment.
  * "http://opds-spec.org/acquisition/borrow": Indicates that the complete representation of the content Resource may be retrieved as part of a lending transaction.
  * "http://opds-spec.org/acquisition/buy": Indicates that the complete representation of the content Resource may be retrieved as part of a purchase.
  * "http://opds-spec.org/acquisition/sample": Indicates that a subset of the content Resource may be retrieved.
  * "http://opds-spec.org/acquisition/subscribe": Indicates that the complete representation of the content Resource may be retrieved as part of a subscription.

=== Covers and Artwork Relations ===

OPDS Catalog Entries MAY include relations to images that provide a visual representation of the electronic publication. For many publications, these images will be the publication's cover or other distinguishing artwork. 

Catalog Entries MUST use one of the following link relations for these images:

  * "http://opds-spec.org/cover": a high-quality version of the image 
  * "http://opds-spec.org/thumbnail": a version of the image suitable for presentation at a small size

The maximum size of the longest dimension of http://opds-spec.org/thumbnail images SHOULD be 120 pixels.

The atom:links with these relations MUST include a type attribute of "image/gif", "image/jpeg", or "image/png" and the image resources MUST be in GIF, JPEG, or PNG format.

While either image resource is optional and may be included independently, OPDS Catalog providers are encouraged to provide both these relations and resources whenever possible. More than one atom:link with either relation SHOULD NOT be provided for a single OPDS Catalog Entry.

Some OPDS Catalog providers MAY choose to provide http://opds-spec.org/thumbnail image resources using the "data" URL scheme from `[RFC2397]`. OPDS Catalog clients SHOULD support the "data" URL scheme if they support Covers and Artwork relations.

== Element Definitions ==

=== The "atom:entry" Element ===

The "atom:entry" element is the document (i.e., top-level) element of an OPDS Catalog Entry Feed Document, acting as a container for metadata and data associated with an available electronic publication.

The following child elements are refined by this specification:

  * OPDS Catalog Entry Documents SHOULD contain at least one Acquisition Link, an atom:link element with a rel attribute value of "http://opds-spec.org/acquisition", "http://opds-spec.org/acquisition/buy", "http://opds-spec.org/acquisition/borrow", "http://opds-spec.org/acquisition/subscribe", or "http://opds-spec.org/acquisition/sample".

=== The "atom:link" Element ===

The "atom:link" element defines a reference from an entry or feed to a Web resource. 

{{{
  atomLink =
    [
      s:rule [
        context = "atom:link[@rel='http://opds-spec.org/acquisition/buy']"
        s:assert [
          test = "opds:price"
          "An atom:link with a rel attribute of 'http://opds-spec.org/acquisition/buy' "
          ~ "must have at least one opds:price element."
        ]
      ]
      s:rule [
        context = "atom:link[@rel='http://opds-spec.org/acquisition']"
        s:assert [
          test = "dc:format"
          "An atom:link with a rel attribute like 'http://opds-spec.org/acquisition' "
          ~ "must have at least one dc:format element."
        ]
      ]
    ]
    element atom:link {
      atomCommonAttributes,
      attribute href { atomUri },
      attribute rel { atomNCName | atomUri }?,
      attribute type { atomMediaType }?,
      attribute hreflang { atomLanguageTag }?,
      attribute title { text }?,
      attribute length { text }?,
      opdsPrice?,
      undefinedOPDSContent
    }
}}}

The following child elements are defined by this specification:

  * atom:link elements with a rel attribute value of "http://opds-spec.org/acquisition/buy" MUST contain one opds:price element.
  * atom:link elements with a rel attribute of "http://opds-spec.org/acquisition/borrow", "http://opds-spec.org/acquisition/subscribe", or "http://opds-spec.org/acquisition/sample" MUST contain at least one dc:format element.
  * atom:link elements with a rel attribute of "http://opds-spec.org/acquisition/borrow", "http://opds-spec.org/acquisition/subscribe", or "http://opds-spec.org/acquisition/sample" MAY contain one opds:price element.

=== The "opds:price" Element ===

The "opds:price" element represents the acquisition price of an individual publication in a particular format from a particular provider. This element can appear as a child of the atom:entry element (in OPDS Catalog Entry Documents). 

The content of opds:price is text describing a currency value.

{{{
opdsPrice = 
  element opds:price {
    attribute currencycode xsd:string { pattern = "[A-Z]{3,3}" },
    text
  }

}}}

==== The "currencycode" Attribute ====

On the opds:price element, the value of the "currencycode" attribute MUST be an "Alphabetic code" from `[ISO4127]`. It defines the currency code used for the content of the opds:price element.

= The Atom Format Type Parameter =

The Atom Publishing Protocol `[RFC5023]` defines the Atom Format Type Parameter.

Producers of OPDS Catalogs SHOULD use the "type" parameter. 

Producers of OPDS Catalog SHOULD produce Catalog Documents that are conformant to both Atom and the OPDS Catalog Relax NG schemas.

= The Atom Format Profile Parameter ==

Relations to OPDS Catalog Document Resources SHOULD use a "profile" parameter from Section 4.3 of `[RFC4288]` with the value "opds-catalog". This profile parameter clients with an advisory hint that the Resource should be an OPDS Catalog.

The complete media type for a relation to an OPDS Catalog Entry Document SHOULD be:

application/atom+xml;type=entry;profile=opds-catalog

The complete media type for a relation to an OPDS Catalog Document SHOULD be:

application/atom+xml;type=feed;profile=opds-catalog

= Collection Handling =

== Listing Publication Collections ==

OPDS Catalog Documents, especially Publication Collections, may contain large numbers of OPDS Catalog Entries. A client such as a web spider or web browser might be overwhelmed if the response to a GET contained every OPDS Catalog Entry in a Publication Collection -- in turn the server might also waste bandwidth and processing time on generating a response that cannot be handled. For this reason, servers MAY respond to Publication Collection GET requests with a paginated response: an OPDS Catalog Document containing a partial list of the Publication Collection's members and a link to the next partial list feed, if it exists, as defined in Section 3 of `[RFC5005]`. 

OPDS Catalog providers SHOULD use Partial Catalog Entries in all Publication Collections except Complete Publication Collections, which are intended for crawling and are referenced using the http://opds-spec.org/crawlable relation. Clients MUST NOT assume that an Atom Entry returned in the Publication Collection is a full representation of an OPDS Catalog Entry Resource, as described in the Section Partial and Complete Entries. 

== Complete Publication Collections ==

An OPDS Catalog provider MAY provide a single, consolidated Publication Collection that includes the complete representation of every unique OPDS Catalog Entry Document in an OPDS Catalog in a single, unpaged atom:feed to faciliate crawling and aggregation. This representation is called a Complete Publication Collection and each Entry MUST be ordered by atom:updated. If available, each OPDS Catalog Document in the OPDS Catalog SHOULD contain an atom:link element with a the relation of "http://opds-spec.org/crawlable" that references the Complete Publication Collection URI. A Complete Publication Collection MUST include a fh:complete element. See Section 2 of `[RFC5005]` for the specification of the fh:complete element. OPDS Catalog providers SHOULD use a compressed Content-Encoding when transmitting Complete Publication Collections over HTTP if possible. See Section 14.11 of `[RFC2616]`.

OPDS Catalog providers MUST include Complete Catalog Entries when serializing a Complete Publication Collection.

= Aggregating OPDS Catalogs =

OPDS Catalogs may be aggregated using the same techniques as Atom Feeds. Aggregators SHOULD use the atom:source element from Section 4.2.11 of `[RFC4287]` to include information about the original OPDS Catalog.

= Discovering OPDS Catalogs =

The most common mechanism for discovering OPDS feeds is to link an HTML document describing the catalog service to the machine readable OPDS Catalog document using the auto-discovery pattern popularized by the syndicated feed community [AUTODISCOVERY].

HTML links SHOULD be expressed using link elements, with a rel attribute "related", and a type attribute "application/atom+xml;type=feed;profile=opds-catalog". Multiple links to OPDS catalogs MAY be expressed in a single HTML document.

{{{
<link rel="related" type="application/atom+xml;profile=opds-catalog" href="/opds-catalogs/catalog" /> 
}}}

= Securing OPDS Catalogs =

OPDS Catalogs are delivered over HTTP. Authentication requirements for HTTP are covered in Section 11 of `[RFC2616]`.

The type of authentication required for any OPDS Catalog is a decision to be made by the OPDS Catalog provider. OPDS Catalog clients are likely to face authentication schemes that vary across Catalogs. At a minimum, client and server implementations MUST be capable of being configured to use HTTP Basic Authentication `[RFC2617]` in conjunction with a connection made with TLS 1.0 `[RFC2246]` or a subsequent standards-track version of TLS supporting the conventions for using HTTP over TLS described in `[RFC2818]`. It is RECOMMENDED that OPDS Catalog clients be implemented in such a way that new authentication schemes can be deployed.

Because this protocol uses HTTP response status codes as the primary means of reporting the result of a request, OPDS Catalog providers are advised to respond to unauthorized or unauthenticated requests using an appropriate 4xx HTTP response code (e.g., 401 "Unauthorized" or 403 "Forbidden") in accordance with `[RFC2617]`.

= Security Considerations =

OPDS Catalogs are Atom documents delivered over HTTP and thus subject to the security considerations found in Section 15 of `[RFC2616]` and Section 5 of `[RFC4287]`.

== Linked Resources ==

OPDS Catalogs can contain XML External Entities as defined in Section 4.2.2 of `[REC-xml]`. OPDS Catalog implementations are not required to load external entities. External entities are subject to the same security concerns as any network operation and can alter the semantics of an OPDS Catalog Document. The same issues exist for Resources linked to by Catalog elements such as atom:link and atom:content.

== URIs and IRIs ==

OPDS Catalog implementations handle URIs and IRIs. See Section 7 of `[RFC3986]` and Section 8 of `[RFC3987]` for security considerations related to their handling and use.

== Code Injection and Cross Site Scripting ==

OPDS Catalogs can contain a broad range of content types including code that might be executable in some contexts. Malicious publishers could attempt to attack servers or other clients by injecting code into OPDS Catalog Documents or OPDS Catalog Entry Documents or Media Resources.

Server implementations are strongly encouraged to verify that external content is safe prior to aggregating, processing, or publishing it. In the case of HTML, experience indicates that verification based on a white list of acceptable content is more effective than a black list of forbidden content.

Additional information about XHTML and HTML content safety can be found in Section 8.1 of `[RFC4287]`.

= References =

== Normative References =

  * `[DRAFT-Web-Linking]` Nottingham, M., "Web Linking", draft-nottingham-http-link-header-09, April 2010, http://tools.ietf.org/html/draft-nottingham-http-link-header.
  * `[ISO4217]` "ISO 4217 currency and funds name and code elements", International Standard ISO 4217, http://www.iso.org/iso/en/prods-services/popstds/currencycodeslist.html.
  * `[OpenSearch]` Clinton D., "Open Search 1.1 Draft 4", http://www.opensearch.org/Specifications/OpenSearch/1.1
  * `[REC-xml]` Yergeau, F., Paoli, J., Bray, T., Sperberg-McQueen, C., and E. Maler, "Extensible Markup Language (XML) 1.0 (Fourth Edition)", World Wide Web Consortium Recommendation REC-xml-20060816, August 2006, http://www.w3.org/TR/2006/REC-xml-20060816.
  * `[REC-xml-infoset]` Cowan, J. and R. Tobin, "XML Information Set (Second Edition)", World Wide Web Consortium Recommendation REC-xml-infoset-20040204, February 2004, http://www.w3.org/TR/2004/REC-xml-infoset-20040204.
  * `[REC-xml-names]` Hollander, D., Bray, T., Tobin, R., and A. Layman, "Namespaces in XML 1.0 (Second Edition)", World Wide Web Consortium Recommendation REC-xml-names-20060816, August 2006, http://www.w3.org/TR/2006/REC-xml-names-20060816.
  * `[RFC2119]` Bradner, S., "Key words for use in RFCs to Indicate Requirement Levels", BCP 14, RFC 2119, March 1997.
  * `[RFC2246]` Dierks, T. and C. Allen, "The TLS Protocol Version 1.0", RFC 2246, January 1999.
  * `[RFC2397]` L. Masinter, "The 'data' URL scheme", RFC 2397, August 1998.
  * `[RFC2616]` Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, "Hypertext Transfer Protocol -- HTTP/1.1", RFC 2616, June 1999.
  * `[RFC2617]` Franks, J., Hallam-Baker, P., Hostetler, J., Lawrence, S., Leach, P., Luotonen, A., and L. Stewart, "HTTP Authentication: Basic and Digest Access Authentication", RFC 2617, June 1999.
  * `[RFC2818]` Rescorla, E., "HTTP Over TLS", RFC 2818, May 2000.
  * `[RFC3187]` J. Hakala, J. and H. Walravens, "Using International Standard Book Numbers as Uniform Resource Names", RFC 3187, October 2001.
  * `[RFC3986]` Berners-Lee, T., Fielding, R., and L. Masinter, "Uniform Resource Identifier (URI): Generic Syntax", STD 66, RFC 3986, January 2005.
  * `[RFC3987]` Duerst, M. and M. Suignard, "Internationalized Resource Identifiers (IRIs)", RFC 3987, January 2005.
  * `[RFC4287]` Nottingham, M. and R. Sayre, "The Atom Syndication Format", RFC 4287, December 2005.  
  * `[RFC4288]` Freed, N. and J. Klensin, "Media Type Specifications and Registration Procedures", RFC 4288, December 2005.  
  * `[RFC5005]` Nottingham, M., "Feed Paging and Archiving", RFC 5005, September 2007.   
  * `[RFC5012]` Gregorio, J. and B. de hOra, "The Atom Publishing Protocol", RFC 5023, October 2007.

== Informative References ==

  * `[AUTODISCOVERY]` Cadenhead, R., Holderness, J., Morin, R., "RSS Autodiscovery", November 2006, http://www.rssboard.org/rss-autodiscovery.
  * `[REC-webarch]` Walsh, N. and I. Jacobs, "Architecture of the World Wide Web, Volume One", W3C REC REC-webarch-20041215, December 2004, http://www.w3.org/TR/2004/REC-webarch-20041215.
  * `[RNC]` Clark, J., "RELAX NG Compact Syntax", December 2001, http://www.oasis-open.org/committees/relax-ng/compact-20021121.html.
  * `[DRAFT-parameter]` Inkster, T., "The Profile Media Type Parameter," October 2009, http://buzzword.org.uk/2009/draft-inkster-profile-parameter-00.html.

= Appendix A. Contributors =

The content and concepts within are a product of the OpenPub community.

= Appendix B. RELAX NG Compact Schema =

This appendix is normative.

The Relax NG schema explicitly excludes elements in the OPDS namespace that are not defined in this revision of the specification. Requirements for Atom Protocol processors encountering such markup are given in Sections 6.2 and 6.3 of `[RFC4287]`.

TODO

The Schema for OPDS Catalog Documents:
{{{
# -*- rnc -*- # RELAX NG Compact Syntax Grammar for OPDS Catalog Documents:
}}}
http://openpub.googlecode.com/svn/trunk/schemas/opds_catalog.rnc

The Schema for OPDS Catalog Entry Documents:
{{{
# -*- rnc -*- # RELAX NG Compact Syntax Grammar for OPDS Catalog Entry Documents:
}}}
http://openpub.googlecode.com/svn/trunk/schemas/opds_catalog_entry.rnc