#summary The current bleeding-edge draft of the OPDS Catalog specification.
#labels Featured,Phase-Design

<wiki:toc max_depth="4" />

= Status of this Draft =

This document specifies a draft of the OPDS Catalog specification. Distribution of this memo is unlimited.

= License =

This document is licensed under [http://creativecommons.org/licenses/by-sa/3.0/ Creative Commons Attribution-Share Alike].

= Abstract =

The Open Publication Distribution System (OPDS) Catalog format is a syndication format for electronic publications based on Atom and HTTP. Catalogs enable the aggregation, distribution, discovery, and acquisition of electronic publications. OPDS Catalogs use existing or emergent open standards and conventions, with a priority on simplicity. 

= Introduction =

The Open Publication Distribution System (OPDS) Catalog format is a syndication format for electronic publications based on Atom `[RFC4287]` and HTTP `[RFC2616]`. OPDS Catalogs enable available electronic publications to be:

  * discovered, using optional search or a range of optional browsing techniques TODO
  * acquired, using direct downloads, lending, or vending

An OPDS Catalog is made up of one or more Feeds. Each Feed is either a list of links to other Feeds or a list of Entries. An Entry describes an available electronic publication and includes basic metadata, the publication's format, and how the publication can be acquired. An Entry may have a more extensive, standalone representation at a unique URI.

OPDS Catalogs may be aggregated and combined into larger OPDS Catalogs.

= Notational Conventions =

The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in `[RFC2119]`.

= XML-Related Conventions =

== Referring to Information Items ==

The OPDS Catalog format is specified in terms of the XML Information Set `[REC-xml-infoset]`, serialized as XML 1.0 `[REC-xml]`.

The Infoset terms "Element Information Item" and "Attribute Information Item" are shortened to "element" and "attribute" respectively. Therefore, when this specification uses the term "element", it is referring to an Element Information Item, and when it uses the term "attribute", it is referring to an Attribute Information Item.

= RELAX NG Schema =

Some sections of this specification are illustrated with fragments of a non-normative RELAX NG Compact schema `[RNC]`. However, the text of this specification provides the definition of conformance. Complete schemas appear in TODO.

= Terminology =

For convenience, this format can be referred to as an "OPDS Catalog." The following terminology is used by this specification:

  * Acqusition Link - An atom:link element with a relation that begins "http://opds-spec.org/acquisition" and represents the URI from which the content's complete representation in a particular media type MAY be requested.
  * URI - A Uniform Resource Identifier as defined in `[RFC3986]`. In this specification, the phrase "the URI of a document" is shorthand for "a URI which, when dereferenced, is expected to produce that document as a representation".
  * IRI - An Internationalized Resource Identifier as defined in `[RFC3987]`. Before an IRI found in a document is used by HTTP, the IRI is first converted to a URI. 
  * Resource - A network-accessible data object or service identified by an IRI, as defined in `[RFC2616]`. See `[REC-webarch]` for further discussion on Resources.
  * relation (or "relation of") - Refers to the "rel" attribute value of an atom:link element.
  * Representation - An entity included with a request or response as defined in `[RFC2616]`.
  
TODO From our glossary

= Document Types =

This specification defines two kinds of documents -- OPDS Catalog Documents and OPDS Catalog Entry Documents.

An OPDS Catalog Document is a refinement of an "atom:feed" from the Atom Syndication Format `[RFC4287]`.

An OPDS Catalog Entry Document is a refinement of an "atom:entry" from the Atom Syndication Format `[RFC4287]`.

The namespace name `[REC-xml-names]` for either kind of document is:

http://opds-spec.org/2010/catalog

OPDS Catalog XML Documents MUST be "namespace-well-formed" as specified in Section 7 of `[REC-xml-names]`.

This specification uses the prefix "opds:" for the namespace name. The prefix "atom:" is used for "http://opds-spec.org/2010/Catalog", the namespace name of the Atom Syndication Format `[RFC4287]`. These namespace prefixes are not semantically significant.

== Document Extensibility ==

Unrecognized markup in an OPDS Catalog is considered "foreign markup" as defined in Section 6 of the Atom Syndication Format `[RFC4287]`. Foreign markup can be used anywhere within a Catalog unless it is explicitly forbidden. Processors that encounter foreign markup MUST NOT stop processing and MUST NOT signal an error. Clients SHOULD preserve foreign markup when transmitting such documents.

The namespace name OPDS is reserved for forward-compatible revisions of the Catalog format. This does not exclude the addition of elements and attributes that might not be recognized by processors conformant to this specification. Such unrecognized markup from the OPDS namespace MUST be treated as foreign markup.

TODO: Confirm that the above is our desired forward-compability goal.

= OPDS Catalog Documents =

OPDS Catalog Documents are Atom `[RFC4287]` Feed documents have two serve two purposes:

  * To reference other OPDS Catalog Documents as part of a heirarchy. These Catalog Documents are referred to as Heirarchical Collections. 
  * To collect a set of OPDS Catalog Entries. These Catalog Documents are referred to as Publication Collections. 

Hierarchical Collections describe a desired heirarchy from the Catalog publisher, but OPDS Catalog Documents MAY contain other relations that allow for a non-heirarchical consumption and presentation of the OPDS Catalog Documents.

A Root OPDS Catalog Document TODO...

Each OPDS Catalog Document SHOULD contain an atom:link element with a link relation of "start", which references the Root OPDS Catalog Document URI.

== Hierarchical Collections ==

== Publication Collections ==

For further details on limiting the size of Publication Collections, see Listing Publication Collections.

== Examples ==

A Root OPDS Catalog Document that is the top of a set of Heirarchical Collections. This Catalog Document references two other Catalog Documents using atom:links:
{{{
<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <id>urn:uuid:2853dacf-ed79-42f5-8e8a-a7bb3d1ae6a2</id>
  <link rel="self"  href="/opds-catalogs/root.xml" type="application/atom+xml;type=feed;profile=http://opds-spec.org/2010/catalog"/>
  <link rel="start" href="/opds-catalogs/root.xml" type="application/atom+xml;type=feed;profile=http://opds-spec.org/2010/catalog"/>
  <title>Root OPDS Catalog Example</title>
  <updated>2010-01-10T10:01:10Z</updated>
  <author>
    <name>Spec Writer</name>
    <uri>http://opds-spec.org</uri>
  </author>

  <entry>
	<title>Popular Publications</title>
	<link type="application/atom+xml;type=feed;profile=http://opds-spec.org/2010/catalog" rel="start" href="/opds-catalogs/popular.xml"/>
	<updated>2010-01-10T10:01:01Z</updated>
	<id>urn:uuid:d49e8018-a0e0-499e-9423-7c175fa0c56c</id>
	<content type="text">Popular publications from this catalog based on downloads.</content>
	</entry>
	<entry>
	<title>New Publications</title>
	<link type="application/atom+xml;type=feed;profile=http://opds-spec.org/2010/catalog" href="/opds-catalogs/new.xml"/>
	<updated>2010-01-10T10:01:00Z</updated>
	<id>urn:uuid:d49e8018-a0e0-499e-9423-7c175fa0c56c</id>
	<content type="text">Recent publications from this catalog.</content>
  </entry>
</feed>
}}}

A Publication Collection listing OPDS Catalog Entries:
{{{
<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"
      xmlns:dc="http://purl.org/dc/terms/"
      xmlns:opds="http://opds-spec.org/2010/catalog">
  <id>urn:uuid:433a5d6a-0b8c-4933-af65-4ca4f02763eb</id>
  <link rel="self"  href="/opds-catalogs/new.xml" type="application/atom+xml;type=feed;profile=http://opds-spec.org/2010/catalog"/>
  <link rel="start" href="/opds-catalogs/root.xml" type="application/atom+xml;type=feed;profile=http://opds-spec.org/2010/catalog"/>
  <title>New Publications</title>
  <updated>2010-01-10T10:01:11Z</updated>
  <author>
    <name>Spec Writer</name>
    <uri>http://opds-spec.org</uri>
  </author>

  <entry>
    <title>Bob, Son of Bob</title>
    <id>urn:uuid:6409a00b-7bf2-405e-826c-3fdff0fd0734</id>
    <author>
      <name>Bob the Recursive</name>
      <uri>http://opds-spec.org/authors/1285</uri>
    </author>
    <updated>2010-01-10T10:01:11Z</updated>
    <dc:language>en</dc:language>
    <dc:issued>1917</dc:issued>
    <content type="text">The story of the son of the Bob and the gallant part he played in the lives of a man and a woman.</content>
    <link type="application/epub+zip"           rel="http://opds-spec.org/acquisition" href="http://opds-spec.org/content/free/4561.epub"/>
    <link type="application/x-mobipocket-ebook" rel="http://opds-spec.org/acquisition" href="http://opds-spec.org/content/free/4561.mobi"/>
    <link type="image/png" rel="http://opds-spec.org/cover"           href="http://opds-spec.org/covers/4561.lrg.png"/>
    <link type="image/png" rel="http://opds-spec.org/cover-thumbnail" href="http://opds-spec.org/covers/4561.thmb.png"/>
 </entry>

 <entry>
    <title>Modern Online Philately</title>
    <id>urn:uuid:7b595b0c-e15c-4755-bf9a-b7019f5c1dab</id>
    <author>
      <name>Stampy McGee</name>
      <uri>http://opds-spec.org/authors/21285</uri>
    </author>
    <author>
      <name>Alice McGee</name>
      <uri>http://opds-spec.org/authors/21284</uri>
    </author>
    <author>
      <name>Harold McGee</name>
      <uri>http://opds-spec.org/authors/21283</uri>
    </author>
    <updated>2010-01-10T10:01:10Z</updated>
    <dc:identifier>urn:isbn:978029536341X</dc:identifier>
    <dc:publisher>StampMeOnline, Inc.</dc:publisher>
    <dc:language>en</dc:language>
    <dc:issued>2009-10-01</dc:issued>
    <content type="text">The definitive reference for the web-curious philatelist.</content>
    <link type="image/png" rel="http://opds-spec.org/cover" href="http://opds-spec.org/covers/11241.lrg.png"/>
    <link type="application/epub+zip"           
          rel="http://opds-spec.org/acquisition/buy" 
          href="http://opds-spec.org/content/buy/11241.epub">
      <opds:price currencycode="USD">18.99</opds:price>
    </link>
 </entry>
</feed>
}}}

== Element Definitions ==

=== The "atom:feed" Element ===

The "atom:feed" element is the document (i.e., top-level) element of an OPDS Catalog Document, acting as a container for metadata, hierarchy, and publications associated with the Catalog.  Its element children consist of metadata elements followed by zero or more atom:entry child elements.

The following child elements are refined by this specification:

  * OPDS Catalog Documents SHOULD contain one atom:link element with a rel attribute value of "self". This is the preferred URI for retrieving the atom:feed representing this OPDS Catalog Document.

= OPDS Catalog Entry Documents =

OPDS Catalog Entry Documents are Atom `[RFC4287]` Entry documents that provide a complete representation of the metadata and data associated with an available electronic publication.

== Element Definitions ==

=== The "atom:entry" Element ===

The "atom:entry" element is the document (i.e., top-level) element of an OPDS Catalog Entry Feed Document, acting as a container for metadata and data associated with an available electronic publication.

The following child elements are refined by this specification:

  * OPDS Catalog Entry Documents SHOULD contain at least one Acqusition Link, an atom:link element with a rel attribute value of "http://opds-spec.org/acquisition", "http://opds-spec.org/acquisition/buy", "http://opds-spec.org/acquisition/borrow", "http://opds-spec.org/acquisition/subscribe", or "http://opds-spec.org/acquisition/sample".

=== The "atom:link" Element ===

The "atom:link" element defines a reference from an entry or feed to a Web resource. 

{{{
atomLink =
  [
    s:rule [
      context = "atom:link[@rel='http://opds-spec.org/acquisition/buy']"
      s:assert [
        test = "opds:price"
        "An atom:link with a rel attribute of 'http://opds-spec.org/acquisition/buy'"
        ~ "must have at least one opds:price element."
      ]
    ]
  ]
  element atom:link {
    atomCommonAttributes,
    attribute href { atomUri },
    attribute rel { atomNCName | atomUri }?,
    attribute type { atomMediaType }?,
    attribute hreflang { atomLanguageTag }?,
    attribute title { text }?,
    attribute length { text }?,
    opdsPrice?,
    undefinedContent
  }
}}}

The following child elements are defined by this specification:

  * atom:link elements with a rel attribute value of "http://opds-spec.org/acquisition/buy" MUST contain one opds:price element.
  * atom:link elements with a rel attribute of "http://opds-spec.org/acquisition/borrow", "http://opds-spec.org/acquisition/subscribe", or "http://opds-spec.org/acquisition/sample" MAY contain one opds:price element.

=== The "opds:price" Element ===

The "opds:price" element represents the acquisiton price of an individual publication in a particular format from a particular provider. This element can appear as a child of the atom:entry element (in OPDS Catalog Entry Documents). 

The content of opds:price is text describing a currency value.

{{{
opdsPrice = 
  element opds:price {
    attribute currencycode xsd:string { pattern = "[A-Z]{3,3}" },
    text
  }

}}}

==== The "currencycode" Attribute ====

On the opds:price element, the value of the "currencycode" attribute MUST be an "Alphabetic code" from `[ISO4127]`. It defines the currency code used for the content of the opds:price element.

= The Atom Format Type Parameter =

The Atom Publishing Protocol `[RFC5023]` defines the Atom Format Type Parameter.

Producers of OPDS Catalogs SHOULD use the "type" parameter. 

Producers of OPDS Catalog SHOULD produce Catalog Documents that are conformant to both Atom and the OPDS Catalog Relax NG schemas.

= The Atom Format Profile Parameter ==

TODO Do we want to reference http://buzzword.org.uk/2009/draft-inkster-profile-parameter-00.html or discuss http://markmail.org/thread/nkecztyqs7m6luhb ?

= Listing Publiction Collections =

OPDS Catalog Documents, especially Publication Collections, can contain large numbers of Resources. A client such as a web spider or web browser might be overwhelmed if the response to a GET contained every OPDS Catalog Entry in a Publication Collection -- in turn the server might also waste bandwidth and processing time on generating a response that cannot be handled. For this reason, servers MAY respond to Publication Collection GET requests with a OPDS Catalog Document containing a partial list of the Publication Collection's members, and a link to the next partial list feed, if it exists, as defined in Section 3 of `[RFC5005]`. 

Additionally, clients MUST NOT assume that an Atom Entry returned in the Publication Collection is a full representation of an OPDS Catalog Entry Resource if the entry includes a link relation of "alternate". If such alternate representations of the OPDS Catalog Entry Resources as standalone OPDS Catalog Entry Documents, the partial representation SHOULD include the following elements if they are present in the complete OPDS Catalog Entry Document:

  * atom:category 
  * atom:rights
  * dc:extent
  * dc:identifier
  * dc:issued 
  * dc:language
  * dc:publisher
  * opds:price 
  * prism:issue
  * prism:volume

= Filtering Publication Collections =

Many consumers of OPDS Catalog Documents will not be able to process every media type and will want to filter Publication Collections by the media type's of Acqusition Links. A server MAY allow the filtering of Publication Collections by a set of media types using...

TODO

= Complete Publication Collections =

A server MAY provide a single, consolidated Publication Collection that includes the complete representation of every OPDS Catalog Entry Document in an OPDS Catalog in a single, unpaged atom:feed to faciliate crawling and aggregation. This represenation is called a Complete Publication Collection. If available, each OPDS Catalog Document in the OPDS Catalog SHOULD contain an atom:link element with a the relation of "http://opds-spec.org/crawlable" that references the Complete Publication Collection URI. A Complete Publication Collection MUST include an fh:complete element. See Section 2 of `[RFC5005]` for the specification of the fh:complete element. Servers SHOULD use a compressed Content-Encoding when transmitting Complete Publication Collections over HTTP if possible. See Section 14.11 of `[RFC2616]`.

= Securing OPDS Catalogs =

OPDS Catalogs are delivered over HTTP. Authentication requirements for HTTP are covered in Section 11 of `[RFC2616]`.

TODO_GETHELP Point to Atom's description here?

The choice of authentication mechanism will impact interoperability.....

The minimum level of security referenced above (Basic Authentication with TLS) is considered good practice for Internet applications at the time of publication of this specification and sufficient for establishing a baseline for interoperability. Implementers are encouraged to investigate and use alternative mechanisms regarded as equivalently good or better at the time of deployment. It is RECOMMENDED that clients be implemented in such a way that new authentication schemes can be deployed.

Because this protocol uses HTTP response status codes as the primary means of reporting the result of a request, servers are advised to respond to unauthorized or unauthenticated requests using an appropriate 4xx HTTP response code (e.g., 401 "Unauthorized" or 403 "Forbidden") in accordance with `[RFC2617]`.

= Security Considerations =

OPDS Catalogs are delivered over HTTP and thus subject to the security considerations found in Section 15 of `[RFC2616]`.

TODO_GETHELP

== Linked Resources ==

OPDS Catalogs can contain XML External Entities as defined in Section 4.2.2 of `[REC-xml]`. Catalog implementations are not required to load external entities. External entities are subject to the same security concerns as any network operation and can alter the semantics of a Catalog document. The same issues exist for Resources linked to by Catalog elements such as atom:link and atom:content.

== URIs and IRIs ==

OPDS Catalog implementations handle URIs and IRIs. See Section 7 of `[RFC3986]` and Section 8 of `[RFC3987]` for security considerations related to their handling and use.

== Code Injection and Cross Site Scripting ==

OPDS Catalogs can contain a broad range of content types including code that might be executable in some contexts. Malicious publishers could attempt to attack servers or other clients by injecting code into OPDS Catalog Documents or OPDS Catalog Entry Documents or Media Resources.

Server implementations are strongly encouraged to verify that external content is safe prior to aggregating, processing, or publishing it. In the case of HTML, experience indicates that verification based on a white list of acceptable content is more effective than a black list of forbidden content.

Additional information about XHTML and HTML content safety can be found in Section 8.1 of `[RFC4287]`.

= References =

== Normative References =

  * `[DRAFT-Web-Linking]` Nottingham, M., "Web Linking", draft-nottingham-http-link-header-06, June 2009, http://www.ietf.org/id/draft-nottingham-http-link-header-06.txt.
  * `[ISO4217]` "ISO 4217 currency and funds name and code elements", International Standard ISO 4217, http://www.iso.org/iso/en/prods-services/popstds/currencycodeslist.html.
  * `[REC-xml]` Yergeau, F., Paoli, J., Bray, T., Sperberg-McQueen, C., and E. Maler, "Extensible Markup Language (XML) 1.0 (Fourth Edition)", World Wide Web Consortium Recommendation REC-xml-20060816, August 2006, http://www.w3.org/TR/2006/REC-xml-20060816.
  * `[REC-xml-infoset]` Cowan, J. and R. Tobin, "XML Information Set (Second Edition)", World Wide Web Consortium Recommendation REC-xml-infoset-20040204, February 2004, http://www.w3.org/TR/2004/REC-xml-infoset-20040204.
  * `[REC-xml-names]` Hollander, D., Bray, T., Tobin, R., and A. Layman, "Namespaces in XML 1.0 (Second Edition)", World Wide Web Consortium Recommendation REC-xml-names-20060816, August 2006, http://www.w3.org/TR/2006/REC-xml-names-20060816.
  * `[RFC2119]` Bradner, S., "Key words for use in RFCs to Indicate Requirement Levels", BCP 14, RFC 2119, March 1997.
  * `[RFC2616]` Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, "Hypertext Transfer Protocol -- HTTP/1.1", RFC 2616, June 1999.
  * `[RFC2617]`  Franks, J., Hallam-Baker, P., Hostetler, J., Lawrence, S., Leach, P., Luotonen, A., and L. Stewart, "HTTP Authentication: Basic and Digest Access Authentication", RFC 2617, June 1999.
  * `[RFC3187]` J. Hakala, J. and H. Walravens, "Using International Standard Book Numbers as Uniform Resource Names", RFC 3187, October 2001.
  * `[RFC3986]` Berners-Lee, T., Fielding, R., and L. Masinter, "Uniform Resource Identifier (URI): Generic Syntax", STD 66, RFC 3986, January 2005.
  * `[RFC3987]` Duerst, M. and M. Suignard, "Internationalized Resource Identifiers (IRIs)", RFC 3987, January 2005.
  * `[RFC4287]` Nottingham, M. and R. Sayre, "The Atom Syndication Format", RFC 4287, December 2005.  
  * `[RFC5005]` Nottingham, M., "Feed Paging and Archiving", RFC 5005, September 2007.   
  * `[RFC5012]` Gregorio, J. and B. de hOra, "The Atom Publishing Protocol", RFC 5023, October 2007.

== Informative References ==

  * `[REC-webarch]` Walsh, N. and I. Jacobs, "Architecture of the World Wide Web, Volume One", W3C REC REC-webarch-20041215, December 2004, http://www.w3.org/TR/2004/REC-webarch-20041215.
  * `[RNC]` Clark, J., "RELAX NG Compact Syntax", December 2001, http://www.oasis-open.org/committees/relax-ng/compact-20021121.html.

= Appendix A. Contributors =

The content and concepts within are a product of the OpenPub community.

= Appendix B. RELAX NG Compact Schema =

This appendix is informative.

The Relax NG schema explicitly excludes elements in the OPDS namespace that are not defined in this revision of the specification. Requirements for Atom Protocol processors encountering such markup are given in Sections 6.2 and 6.3 of `[RFC4287]`.

TODO

The Schema for OPDS Catalog Documents:
{{{
# -*- rnc -*- # RELAX NG Compact Syntax Grammar for OPDS Catalog Documents:
}}}
http://openpub.googlecode.com/svn/trunk/schemas/opds_catalog.rnc

The Schema for OPDS Catalog Entry Documents:
{{{
# -*- rnc -*- # RELAX NG Compact Syntax Grammar for OPDS Catalog Entry Documents:
}}}
http://openpub.googlecode.com/svn/trunk/schemas/opds_catalog_entry.rnc

